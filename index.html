<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卓球 6名リーグ戦管理システム</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --win-color: #dcfce7;
            --lose-color: #fee2e2;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: #1e293b; }
        .container { max-width: 1000px; margin: auto; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { color: var(--primary-color); margin-bottom: 5px; }
        
        /* 統計テーブル */
        .card { background: var(--card-bg); border-radius: 12px; shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border: 1px solid #e2e8f0; text-align: center; }
        th { background-color: #f1f5f9; }

        /* 試合セクション */
        .round-box { margin-bottom: 30px; }
        .round-title { background: var(--primary-color); color: white; padding: 10px 20px; border-radius: 8px; font-weight: bold; margin-bottom: 15px; }
        .match-row { display: grid; grid-template-columns: 1fr 2fr 1fr; align-items: center; gap: 15px; background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #e2e8f0; }
        .player-name { font-weight: 600; font-size: 1.1em; }
        .score-inputs { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .game-score { width: 50px; height: 40px; font-size: 1.2em; text-align: center; border: 2px solid #cbd5e1; border-radius: 6px; }
        
        /* 点数詳細メモ（オプション） */
        .detail-input { width: 35px; font-size: 0.8em; text-align: center; border: 1px solid #e2e8f0; color: #64748b; }

        .status-bar { position: fixed; bottom: 20px; right: 20px; background: #10b981; color: white; padding: 10px 20px; border-radius: 50px; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .btn-reset { background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; float: right; }
        .rules { font-size: 0.85em; color: #64748b; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>卓球 6名リーグ管理</h1>
        <div class="rules">5ゲームマッチ（3点先取）/ 11点先取 / 勝点：勝2・負1</div>
    </header>

    <div class="card">
        <button class="btn-reset" onclick="resetData()">全データリセット</button>
        <h2>総合ランキング</h2>
        <table>
            <thead>
                <tr>
                    <th>選手</th>
                    <th>試合数</th>
                    <th>勝</th>
                    <th>負</th>
                    <th>勝点</th>
                    <th>勝率</th>
                </tr>
            </thead>
            <tbody id="stats-body"></tbody>
        </table>
    </div>

    <div id="matches-container"></div>
</div>

<div id="status-bar" class="status-bar">保存されました</div>

<script>
const players = ["選手1", "選手2", "選手3", "選手4", "選手5", "選手6"];
// 1周3試合 × 5周 の対戦組合せ
const schedule = [
    [[0, 1], [2, 3], [4, 5]], // 1周目
    [[0, 2], [1, 4], [3, 5]], // 2周目
    [[0, 3], [1, 5], [2, 4]], // 3周目
    [[0, 4], [2, 5], [1, 3]], // 4周目
    [[0, 5], [1, 2], [3, 4]]  // 5周目
];

function init() {
    const container = document.getElementById('matches-container');
    schedule.forEach((round, rIdx) => {
        const roundDiv = document.createElement('div');
        roundDiv.className = 'round-box';
        roundDiv.innerHTML = `<div class="round-title">第 ${rIdx + 1} 周目</div>`;
        
        round.forEach((m, mIdx) => {
            const matchId = `r${rIdx}_m${mIdx}`;
            roundDiv.innerHTML += `
                <div class="match-row">
                    <div class="player-name" style="text-align:right">${players[m[0]]}</div>
                    <div class="score-inputs">
                        <input type="number" id="${matchId}_s0" class="game-score" min="0" max="3" onchange="calc()">
                        <span>-</span>
                        <input type="number" id="${matchId}_s1" class="game-score" min="0" max="3" onchange="calc()">
                    </div>
                    <div class="player-name">${players[m[1]]}</div>
                </div>
            `;
        });
        container.appendChild(roundDiv);
    });
    load();
}

function calc() {
    let stats = players.map(name => ({ name, m: 0, w: 0, l: 0, pts: 0 }));

    schedule.forEach((round, rIdx) => {
        round.forEach((m, mIdx) => {
            const s0 = parseInt(document.getElementById(`r${rIdx}_m${mIdx}_s0`).value);
            const s1 = parseInt(document.getElementById(`r${rIdx}_m${mIdx}_s1`).value);

            if (!isNaN(s0) && !isNaN(s1)) {
                stats[m[0]].m++; stats[m[1]].m++;
                if (s0 > s1) {
                    stats[m[0]].w++; stats[m[0]].pts += 2;
                    stats[m[1]].l++; stats[m[1]].pts += 1;
                } else if (s1 > s0) {
                    stats[m[1]].w++; stats[m[1]].pts += 2;
                    stats[m[0]].l++; stats[m[0]].pts += 1;
                }
            }
        });
    });

    // 順位表の描画
    const tbody = document.getElementById('stats-body');
    tbody.innerHTML = stats.map(s => `
        <tr>
            <td><strong>${s.name}</strong></td>
            <td>${s.m}</td>
            <td style="color:green">${s.w}</td>
            <td style="color:red">${s.l}</td>
            <td>${s.pts}</td>
            <td>${s.m > 0 ? (s.w / s.m * 100).toFixed(1) + '%' : '-'}</td>
        </tr>
    `).join('');

    save();
}

function save() {
    const data = {};
    document.querySelectorAll('.game-score').forEach(el => data[el.id] = el.value);
    localStorage.setItem('tt_league_v1', JSON.stringify(data));
    showStatus();
}

function load() {
    const data = JSON.parse(localStorage.getItem('tt_league_v1'));
    if (data) {
        Object.keys(data).forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = data[id];
        });
        calc();
    }
}

function showStatus() {
    const bar = document.getElementById('status-bar');
    bar.style.display = 'block';
    setTimeout(() => bar.style.display = 'none', 1000);
}

function resetData() {
    if (confirm('全てのデータを消去してリセットしますか？')) {
        localStorage.removeItem('tt_league_v1');
        location.reload();
    }
}

window.onload = init;
</script>

</body>
</html>